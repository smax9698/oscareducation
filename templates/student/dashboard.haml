-extends "base.haml"

-load static
-load student_tags
-load lesson_tags
-load compress

-block head
  -compress js
    %script{type: "text/javascript", src: "{% static 'js/detailledViewStudent.js' %}"}
  -compress css
    %link{href: "{% static 'css/detailledViewStudent.css' %}", rel: "stylesheet"}

-block breadcrumb
  -with lesson=user.student.lesson_set.first
    %ol.breadcrumb
      %li.active
        Classe
        =lesson.name

-block content-student
  .container-fluid.boxclassetitle
    .center
      %span.green
        <img class='icon student-skill' src='/static/img/icons/mastered.png' /> = maîtrisé,
      %span.orange
        <img class='icon student-skill' src='/static/img/icons/not-mastered.png' /> = non maîtrisé,
      %span.gris
        <img class='icon student-skill' src='/static/img/icons/not-tested.png' /> = pas encore testé,
      %span.orange
        <img class='icon student-skill' src='/static/img/icons/recommended.png' /> = compétence recommandée non maîtrisée.

  %br

  -with lesson=user.student.lesson_set.first
    .row
      .col-md-6
        -for stage in lesson.stages_in_unchronological_order
          -get_students_skills of user.student at stage rename "student_skills"
          -if forloop.first
            .container-fluid.boxclassetitle
              %h5
                Mon empreinte
                Niveau {{ stage.name }}

            .ligneorangefine

            .container-fluid.boxclasse
              -regroup student_skills by skill.section as sections
              -for section in sections
                .panel.panel-default
                  .panel-heading.student-section-round
                    =section.grouper
                    -with student_skill=section.list|first
                      %i.round-section-icon{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}"}
                      %span{style:'float:right;'}
                        %a{href: '{% url "student_skill_pedagogic_ressources" "section" section.grouper.id %}'}
                          %img.icon{src: "{% static 'img/icons/ressource-white.png' %}", title: "Accéder aux ressources du chapitre" }

                %table.table-hover.table
                  -for student_skill in section.list
                    %tr.legend-list
                      %td.legend
                        -if student_skill.acquired
                          %img.icon.student-skill{src: "{% static 'img/icons/mastered.png' %}"}
                        -elif student_skill.tested
                          -if student_skill.recommended_to_learn
                            %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                          -else
                            %img.icon.student-skill{src: "{% static 'img/icons/not-mastered.png' %}"}
                        -else
                          %img.icon.student-skill{src: "{% static 'img/icons/not-tested.png' %}"}
                      %td.legend
                        %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                          {{ student_skill.skill.name }}

            %br
          -else
            -if forloop.counter == 2
              .container-fluid.boxclassetitle
                %h5 Années précédentes

              .ligneorangefine

              <div class="container-fluid boxclasse">
            .panel.panel-default
              .panel-heading
                Niveau {{ stage.name }}
              .panel-body
                %table
                  -for student_skill in student_skills|strip_untested_skills
                    -if forloop.first
                      <tr>
                    -elif forloop.counter0|divisibleby:5
                      </tr><tr>
                    %td{style: "text-align: center; width: 100px; padding: 10px;"}
                      %a{type: "button", style: '{% if student_skill.tested or student_skill.acquired %}color: white;{% endif %}; width: 100%{% if student_skill.recommended_to_learn %}; border: black solid;{% endif %}', href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}', class: "btn btn-{% if student_skill.acquired %}success{% elif student_skill.tested %}warning{% else %}default{% endif %} skill"}
                        %i{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}"}

                    -if forloop.last
                      </tr>
            -if forloop.last
              </div>


        %h5 Légende

        .row
          .col-md-6
            %ul.legend-list
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-plus-square
                nombres
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-cube
                solides et figures
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-arrows-v
                grandeurs
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-bar-chart
                traitement de données
          .col-md-6
            %ul.legend-list
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-area-chart
                fonctions
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-pie-chart
                probabilités et statistiques
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-gears
                compétences transversales

      .col-md-6
        -if user.student.has_recommended_skills or user.student.get_three_next|length > 0
          .container-fluid.boxclassetitle
            .col-md-10
              %h5 Compétences recommandées
            .col-md-2


              -#
                Btn to view the detailled view in the user dashboard
              %button{:type => "button", :class => "btn btn-primary btn-lg", :data-toggle => "modal", :data-target => "#myModal"}
                %img.icon.student-skill{src: "{% static 'img/icons/detailed_view.png' %}"}

              -#
                Code for the modal dialog in bootstrap
              %div{:class =>"modal fade", :id => "myModal", :tabindex => "-1", :role => "dialog", :aria-labelledby => "myModalLabe"}
                %div{:class => "modal-dialog", :role => "document", :style => "width: 90%;"}
                %div{:class => "modal-dialog", :role => "document", :style => "width: 90%;"}
                  %div{:class => "modal-content", :style => "height: auto; min-height: 100%; border-radius: 10; margin-bottom: 25px;"}
                    %div{:class => "modal-header"}
                      %button{:type => "button", :class => "close", :data-dismiss => "modal", :aria-label => "Close"}
                        %span{:aria-hidden => "true"} &times;
                      %h4{:class => "modal-title", :id => "myModalLabel", :style => "color:black;"} Detailed view
                    %div{:class => "modal-body"}
                      %div{:class=>"container"}
                        %div{:class=>"row"}
                          %div{:class=>"col-md-12"}
                            %div{:class=>"carousel slide multi-item-carousel", :id=>"theCarousel"}
                              %div{:class=>"carousel-inner"}
                                -if user.student.get_learning_track|length > 0
                                  -for item in user.student.get_learning_track
                                    -#-if student_skill.recommended_to_learn
                                    -if forloop.first
                                      %div{:class => "item active"}
                                        %div{:class => "col-xs-3 col-xs-offset-1"}
                                          %a{ :href => '{% url "student_skill_pedagogic_ressources" "skill" item.student_skill.skill.code %}', :title => "{{ item.student_skill.skill.name }}"}
                                            -if item.student_skill.acquired
                                              %img{:src => "http://placehold.it/300/8bc34a/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            -elif item.student_skill.tested
                                              -if item.student_skill.recommended_to_learn
                                                %img{:src => "http://placehold.it/300/0066ff/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                              -else
                                                %img{:src => "http://placehold.it/300/ff6600/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            -else
                                              %img{:src => "http://placehold.it/300/969696/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            <span class="carousel-caption">
                                              {{ item.student_skill.skill.name }}
                                            </span>

                                    -else
                                      %div{:class => "item"}
                                        %div{:class => "col-xs-3 col-xs-offset-1"}
                                          %a{ :href => '{% url "student_skill_pedagogic_ressources" "skill" item.student_skill.skill.code %}', :title =>"{{ item.student_skill.skill.name }}"}
                                            -if item.student_skill.acquired
                                              %img{:src => "http://placehold.it/300/8bc34a/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            -elif item.student_skill.tested
                                              -if item.student_skill.recommended_to_learn
                                                %img{:src => "http://placehold.it/300/0066ff/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                              -else
                                                %img{:src => "http://placehold.it/300/ff6600/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            -else
                                              %img{:src => "http://placehold.it/300/969696/000000?text={{ item.student_skill.skill.code }}", :class=>"img-responsive"}
                                            <span class="carousel-caption">
                                              {{ item.student_skill.skill.name }}
                                            </span>

                                -else
                                  -for student_skill in user.student.get_three_next_recommended
                                    -if forloop.first
                                      %div{:class => "item active"}
                                        %div{:class => "col-xs-3 col-xs-offset-1"}
                                          %a{ :href => '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}', :title => "{{ student_skill.skill.name }}"}
                                            -if student_skill.acquired
                                              %img{:src => "http://placehold.it/300/8bc34a/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            -elif student_skill.tested
                                              -if student_skill.recommended_to_learn
                                                %img{:src => "http://placehold.it/300/0066ff/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                              -else
                                                %img{:src => "http://placehold.it/300/ff6600/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            -else
                                              %img{:src => "http://placehold.it/300/969696/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            <span class="carousel-caption">
                                              {{ student_skill.skill.name }}
                                            </span>

                                    -else
                                      %div{:class => "item"}
                                        %div{:class => "col-xs-3 col-xs-offset-1"}
                                          %a{ :href => '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}', :title =>"{{ student_skill.skill.name }}"}
                                            -if student_skill.acquired
                                              %img{:src => "http://placehold.it/300/8bc34a/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            -elif student_skill.tested
                                              -if student_skill.recommended_to_learn
                                                %img{:src => "http://placehold.it/300/0066ff/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                              -else
                                                %img{:src => "http://placehold.it/300/ff6600/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            -else
                                              %img{:src => "http://placehold.it/300/969696/000000?text={{ student_skill.skill.code }}", :class=>"img-responsive"}
                                            <span class="carousel-caption">
                                              {{ student_skill.skill.name }}
                                            </span>

                      <ul class="pager">
                        <li class="previous"><a href="#theCarousel" role="button" data-slide="prev">&larr; Previous</a></li>
                        <li class="next"><a href="#theCarousel" role="button" data-slide="next">Next &rarr;</a></li>
                      </ul>

                    %div{:class => "modal-footer"}
                      %button{:type => "button", :class => "btn btn-default", :data-dismiss => "modal"}Close




          .ligneorangefine

          .container-fluid.boxclasse

            -#%table.table.table-hover
            -#  -for stage in lesson.stages_in_unchronological_order
            -#    -get_students_skills of user.student at stage rename "student_skills"
            -#    -for student_skill in student_skills
            -#      -if student_skill.recommended_to_learn
            -#        %tr.legend-list
            -#          %td.legend
            -#            %i.round-section-icon.recommended{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}", data-toggle: "tooltip", data-placement: "right", section: "{{ student_skill.skill.section }}"}
            -#          %td.legend
            -#            %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
            -#          %td
            -#            %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
            -#              {{ student_skill.skill.name }}
            %table.table.table-hover
              -if user.student.get_three_next|length > 0
                -for item in user.student.get_three_next
                  %tr.legend-list
                    %td.legend
                      %i.round-section-icon.recommended{class: "fa fa-{{ item.student_skill.skill.image }}", title: "{{ item.student_skill.skill.name }}", data-toggle: "tooltip", data-placement: "right", section: "{{ item.student_skill.skill.section }}"}
                    %td.legend
                      %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                    %td
                      %a{href: '{% url "student_skill_pedagogic_ressources" "skill" item.student_skill.skill.code %}'}
                        {{ item.student_skill.skill.name }}
              -else
                -for student_skill in user.student.get_three_next_recommended
                  %tr.legend-list
                    %td.legend
                      %i.round-section-icon.recommended{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}", data-toggle: "tooltip", data-placement: "right", section: "{{ student_skill.skill.section }}"}
                    %td.legend
                      %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                    %td
                      %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                        {{ student_skill.skill.name }}

        -if user.student.teststudent_set.all|keep_unfinished_tests|remove_closed_tests
          -if user.student.has_recommended_skills or user.student.get_three_next|length > 0
            %br

          .container-fluid.boxclassetitle
            %h5 Test{{ user.student.teststudent_set.all|keep_unfinished_tests|pluralize }} à passer

          .ligneorangefine

          .container-fluid.boxclasse

            .list-group
              -for student_test in user.student.teststudent_set.all|keep_unfinished_tests|remove_closed_tests
                -if not student_test.finished
                  %a.list-group-item{href: "{% url 'student_pass_test' student_test.id %}"}
                    %span.badge= student_test.test.created_at|date:"d/m/Y"
                    =student_test.test.name
