-extends "base.haml"

-load static
-load student_tags
-load lesson_tags

-block breadcrumb
  -with lesson=user.student.lesson_set.first
    %ol.breadcrumb
      %li.active
        Classe
        =lesson.name

-block content-student
  .container-fluid.boxclassetitle
    .center
      %span.green
        <img class='icon student-skill' src='/static/img/icons/mastered.png' /> = maîtrisé,
      %span.orange
        <img class='icon student-skill' src='/static/img/icons/not-mastered.png' /> = non maîtrisé,
      %span.gris
        <img class='icon student-skill' src='/static/img/icons/not-tested.png' /> = pas encore testé,
      %span.orange
        <img class='icon student-skill' src='/static/img/icons/recommended.png' /> = compétence recommandée non maîtrisée.

  %br

  -with lesson=user.student.lesson_set.first
    .row
      .col-md-6
        -for stage in lesson.stages_in_unchronological_order
          -get_students_skills of user.student at stage rename "student_skills"
          -if forloop.first
            .container-fluid.boxclassetitle
              %h5
                Mon empreinte
                Niveau {{ stage.name }}

            .ligneorangefine

            .container-fluid.boxclasse
              -regroup student_skills by skill.section as sections
              -for section in sections
                .panel.panel-default
                  .panel-heading.student-section-round
                    =section.grouper
                    -with student_skill=section.list|first
                      %i.round-section-icon{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}"}
                      %span{style:'float:right;'}
                        %a{href: '{% url "student_skill_pedagogic_ressources" "section" section.grouper.id %}'}
                          %img.icon{src: "{% static 'img/icons/ressource-white.png' %}", title: "Accéder aux ressources du chapitre" }

                %table.table-hover.table
                  -for student_skill in section.list
                    %tr.legend-list
                      %td.legend
                        -if student_skill.acquired
                          %img.icon.student-skill{src: "{% static 'img/icons/mastered.png' %}"}
                        -elif student_skill.tested
                          -if student_skill.recommended_to_learn
                            %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                          -else
                            %img.icon.student-skill{src: "{% static 'img/icons/not-mastered.png' %}"}
                        -else
                          %img.icon.student-skill{src: "{% static 'img/icons/not-tested.png' %}"}
                      %td.legend
                        %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                          {{ student_skill.skill.name }}

            %br
          -else
            -if forloop.counter == 2
              .container-fluid.boxclassetitle
                %h5 Années précédentes

              .ligneorangefine

              <div class="container-fluid boxclasse">
            .panel.panel-default
              .panel-heading
                Niveau {{ stage.name }}
              .panel-body
                %table
                  -for student_skill in student_skills|strip_untested_skills
                    -if forloop.first
                      <tr>
                    -elif forloop.counter0|divisibleby:5
                      </tr><tr>
                    %td{style: "text-align: center; width: 100px; padding: 10px;"}
                      %a{type: "button", style: '{% if student_skill.tested or student_skill.acquired %}color: white;{% endif %}; width: 100%{% if student_skill.recommended_to_learn %}; border: black solid;{% endif %}', href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}', class: "btn btn-{% if student_skill.acquired %}success{% elif student_skill.tested %}warning{% else %}default{% endif %} skill"}
                        %i{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}"}

                    -if forloop.last
                      </tr>
            -if forloop.last
              </div>


        %h5 Légende

        .row
          .col-md-6
            %ul.legend-list
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-plus-square
                nombres
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-cube
                solides et figures
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-arrows-v
                grandeurs
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-bar-chart
                traitement de données
          .col-md-6
            %ul.legend-list
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-area-chart
                fonctions
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-pie-chart
                probabilités et statistiques
              %li.legend
                .btn.btn-default.right-space
                  %i.fa.fa-gears
                compétences transversales

      .col-md-6
        -if user.student.has_recommended_skills
          .container-fluid.boxclassetitle
            .col-md-10
              %h5 Compétences recommandées
            .col-md-2


              -#
                Btn to view the detailled view in the user dashboard
              %button{:type => "button", :class => "btn btn-primary btn-lg", :data-toggle => "modal", :data-target => "#myModal"}
                %img.icon.student-skill{src: "{% static 'img/icons/detailed_view.png' %}"}

              -#
                Code for the modal dialog in bootstrap
              %div{:class =>"modal fade", :id => "myModal", :tabindex => "-1", :role => "dialog", :aria-labelledby => "myModalLabe"}
                %div{:class => "modal-dialog", :role => "document", :style => "width: 90%; height: 90%;"}
                  %div{:class => "modal-content", :style => "height: auto; min-height: 100%; border-radius: 10; margin-bottom: 25px;"}
                    %div{:class => "modal-header"}
                      %button{:type => "button", :class => "close", :data-dismiss => "modal", :aria-label => "Close"}
                        %span{:aria-hidden => "true"} &times;
                      %h4{:class => "modal-title", :id => "myModalLabel", :style => "color:black;"} Detailed view
                    %div{:class => "modal-body"}
                      <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" data-interval="false">
                        <div class="carousel-inner" role="listbox">
                          -# TODO change for the learning track!!
                          -for stage in lesson.stages_in_unchronological_order
                            -get_students_skills of user.student at stage rename "student_skills"
                            -for student_skill in student_skills
                              -#-if student_skill.recommended_to_learn
                              -if forloop.first
                                %div{:class => "item active", :style => "height:90%; min-height:150px"}
                                  .row
                                    .col-xs-2
                                      -if student_skill.acquired
                                        %img.icon.student-skill{src: "{% static 'img/icons/mastered.png' %}"}
                                      -elif student_skill.tested
                                        -if student_skill.recommended_to_learn
                                          %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                                        -else
                                          %img.icon.student-skill{src: "{% static 'img/icons/not-mastered.png' %}"}
                                      -else
                                        %img.icon.student-skill{src: "{% static 'img/icons/not-tested.png' %}"}
                                    .col-xs-10
                                      %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                                        {{ student_skill.skill.name }}
                              -else
                                %div{:class => "item", :style => "height:90%; min-height:150px"}
                                  .row
                                    .col-xs-2
                                      -if student_skill.acquired
                                        %img.icon.student-skill{src: "{% static 'img/icons/mastered.png' %}"}
                                      -elif student_skill.tested
                                        -if student_skill.recommended_to_learn
                                          %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                                        -else
                                          %img.icon.student-skill{src: "{% static 'img/icons/not-mastered.png' %}"}
                                      -else
                                        %img.icon.student-skill{src: "{% static 'img/icons/not-tested.png' %}"}
                                    .col-xs-10
                                      %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                                        {{ student_skill.skill.name }}
                                  -#<img data-src="holder.js/1140x500/auto/#777:#555/text:{{ student_skill.skill.name }}" alt="{{ student_skill.skill.name }}" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTE0MCIgaGVpZ2h0PSI1MDAiIHZpZXdCb3g9IjAgMCAxMTQwIDUwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PCEtLQpTb3VyY2UgVVJMOiBob2xkZXIuanMvMTE0MHg1MDAvYXV0by8jNzc3OiM1NTUvdGV4dDpGaXJzdCBzbGlkZQpDcmVhdGVkIHdpdGggSG9sZGVyLmpzIDIuNi4wLgpMZWFybiBtb3JlIGF0IGh0dHA6Ly9ob2xkZXJqcy5jb20KKGMpIDIwMTItMjAxNSBJdmFuIE1hbG9waW5za3kgLSBodHRwOi8vaW1za3kuY28KLS0+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48IVtDREFUQVsjaG9sZGVyXzE1ZjZkOTM3ZTk1IHRleHQgeyBmaWxsOiM1NTU7Zm9udC13ZWlnaHQ6Ym9sZDtmb250LWZhbWlseTpBcmlhbCwgSGVsdmV0aWNhLCBPcGVuIFNhbnMsIHNhbnMtc2VyaWYsIG1vbm9zcGFjZTtmb250LXNpemU6NTdwdCB9IF1dPjwvc3R5bGU+PC9kZWZzPjxnIGlkPSJob2xkZXJfMTVmNmQ5MzdlOTUiPjxyZWN0IHdpZHRoPSIxMTQwIiBoZWlnaHQ9IjUwMCIgZmlsbD0iIzc3NyIvPjxnPjx0ZXh0IHg9IjM5MS41IiB5PSIyNzUuNSI+Rmlyc3Qgc2xpZGU8L3RleHQ+PC9nPjwvZz48L3N2Zz4=" data-holder-rendered="true">
                        </div>
                      </div>

                      <ul class="pager">
                        <li class="previous"><a href="#carousel-example-generic" role="button" data-slide="prev">&larr; Previous</a></li>
                        <li class="next"><a href="#carousel-example-generic" role="button" data-slide="next">Next &rarr;</a></li>
                      </ul>

                    %div{:class => "modal-footer"}
                      %button{:type => "button", :class => "btn btn-default", :data-dismiss => "modal"}Close




          .ligneorangefine

          .container-fluid.boxclasse

            %table.table.table-hover
              -for stage in lesson.stages_in_unchronological_order
                -get_students_skills of user.student at stage rename "student_skills"
                -for student_skill in student_skills
                  -if student_skill.recommended_to_learn
                    %tr.legend-list
                      %td.legend
                        %i.round-section-icon.recommended{class: "fa fa-{{ student_skill.skill.image }}", title: "{{ student_skill.skill.name }}", data-toggle: "tooltip", data-placement: "right", section: "{{ student_skill.skill.section }}"}
                      %td.legend
                        %img.icon.student-skill{src: "{% static 'img/icons/recommended.png' %}"}
                      %td
                        %a{href: '{% url "student_skill_pedagogic_ressources" "skill" student_skill.skill.code %}'}
                          {{ student_skill.skill.name }}

        -if user.student.teststudent_set.all|keep_unfinished_tests|remove_closed_tests
          -if user.student.has_recommended_skills
            %br

          .container-fluid.boxclassetitle
            %h5 Test{{ user.student.teststudent_set.all|keep_unfinished_tests|pluralize }} à passer

          .ligneorangefine

          .container-fluid.boxclasse

            .list-group
              -for student_test in user.student.teststudent_set.all|keep_unfinished_tests|remove_closed_tests
                -if not student_test.finished
                  %a.list-group-item{href: "{% url 'student_pass_test' student_test.id %}"}
                    %span.badge= student_test.test.created_at|date:"d/m/Y"
                    =student_test.test.name
